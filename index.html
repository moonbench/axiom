<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Untitled project</title>

  <style type="text/css">
    body{
      background-color: #050505;
      color: #BEBEBE;
      font-family: arial, sans-serif;
    }
    #fps_meter{
      position: absolute;
      bottom: 1.2em;
      left: 1.1em;
      width: 200px;
      margin: 0px auto;
      min-height: 3em;
    }
    #game_canvas{
      border: 1px solid #333;
      background-color: #000;
      cursor: none;
      display: block;
      margin: 0px auto;
    }
    #container{
      width: 1280px;
      margin: 0px auto;
      position: relative;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="fps_meter"></div>
    <div id="game">
      <canvas id="game_canvas" width="1280" height="720"></canvas>
    </div>
  </div>


  <script type="text/javascript" src="js/util/util.js"></script>
  <script type="text/javascript" src="js/util/vector.js"></script>
  <script type="text/javascript" src="js/util/ease.js"></script>

  <script type="text/javascript" src="js/engine/asset_depot.js"></script>
  <script type="text/javascript" src="js/engine/audio_emitter.js"></script>
  <script type="text/javascript" src="js/engine/meter.js"></script>
  <script type="text/javascript" src="js/engine/engine.js"></script>

  <script type="text/javascript" src="js/entities/entity.js"></script>
  <script type="text/javascript" src="js/entities/sprite.js"></script>
  <script type="text/javascript" src="js/entities/solid.js"></script>
  <script type="text/javascript" src="js/entities/moveable.js"></script>
  <script type="text/javascript" src="js/entities/driveable.js"></script>
  <script type="text/javascript" src="js/entities/shooting.js"></script>
  <script type="text/javascript" src="js/entities/missile.js"></script>
  <script type="text/javascript" src="js/entities/damageable.js"></script>
  <script type="text/javascript" src="js/entities/particle.js"></script>
  <script type="text/javascript" src="js/entities/particle_emitter.js"></script>

  <script type="text/javascript" src="js/universe/quadtree.js"></script>
  <script type="text/javascript" src="js/universe/layer.js"></script>
  <script type="text/javascript" src="js/universe/world.js"></script>
  <script type="text/javascript" src="js/universe/viewport.js"></script>

  <script type="text/javascript" src="js/gun.js"></script>
  <script type="text/javascript" src="js/cursor.js"></script>
  <script type="text/javascript" src="js/game.js"></script>

  <script type="text/javascript">
    const game = Game.create("game_canvas", "fps_meter");

    const title_scene = (function(){
      return {
        world: World.create(game.engine.viewport.width, game.engine.viewport.height),

        asset_loading_function: function(engine){
          engine.assets.add_image("title_bg", "assets/titlebg.png");
          engine.assets.add_image("title_planet", "assets/titleplanet.png");
          engine.assets.add_image("title", "assets/title.png");
        },

        entity_loading_function: function(world, assets){
          const bg = MoveableEntity.extend(
            Sprite.create(0, 0, world.height*2, world.width*2, 0, assets.images["title_bg"])
          );
          bg.friction = 0;
          bg.state.rotate = 0.01;
          world.add_entity(bg, 10);

          const planet = MoveableEntity.extend(
            Sprite.create(400, 420, 1500, 1500, 6, assets.images["title_planet"])
          );
          planet.friction = 0;
          planet.state.rotate = 0.01;
          world.add_entity(planet, 75);

          const title = Sprite.create(0, 0, world.height/1.5, world.width/1.5, 0, assets.images["title"]);
          world.add_entity(title, 100);
        },

        handle_mouse_button: function(engine, event, pressed){
          if(pressed) game.set_scene(level_scene);
        },

        handle_mouse_move: function(engine, event){
          const adjusted_x = event.clientX - engine.canvas.getBoundingClientRect().left;
          const adjusted_y = event.clientY - engine.canvas.getBoundingClientRect().top;
          engine.cursor.move_to(adjusted_x, adjusted_y);
        },
      };
    })();


    const level_scene = (function(){
      const world = World.create(20000, 4000);
      world.allow_negative = true;
      return {
        world,
        asset_loading_function: function(engine){
          engine.audio.add_to_group("bg", engine.assets.add_audio("bg3", "assets/bg3.mp3"));
          engine.audio.add_to_group("bg", engine.assets.add_audio("bg2", "assets/bg2.mp3"));
          engine.audio.add_to_group("bg", engine.assets.add_audio("bg1", "assets/bg.mp3"));
          engine.audio.loop("bg", function(){ return true; });
          engine.audio.add_to_group("gun", engine.assets.add_audio("laser1", "assets/laser1.mp3"));
          engine.audio.add_to_group("gun", engine.assets.add_audio("laser2", "assets/laser2.mp3"));
          engine.audio.add_to_group("gun", engine.assets.add_audio("laser3", "assets/laser3.mp3"));
          engine.audio.add_to_group("gun", engine.assets.add_audio("laser4", "assets/laser4.mp3"));
          engine.audio.add_to_group("gun", engine.assets.add_audio("laser5", "assets/laser5.mp3"));
          engine.audio.add_to_group("hit", engine.assets.add_audio("bang1", "assets/bang1.mp3"));
          engine.audio.add_to_group("hit", engine.assets.add_audio("bang2", "assets/bang2.mp3"));
          engine.audio.add_to_group("hit", engine.assets.add_audio("bang3", "assets/bang3.mp3"));
          engine.audio.add_to_group("hit", engine.assets.add_audio("bang4", "assets/bang4.mp3"));
          engine.audio.add_to_group("explode", engine.assets.add_audio("explosion1", "assets/explosion1.mp3"));
          engine.audio.add_to_group("explode", engine.assets.add_audio("explosion2", "assets/explosion2.mp3"));
          engine.audio.add_to_group("explode", engine.assets.add_audio("explosion3", "assets/explosion3.mp3"));
          engine.audio.add_to_group("thruster", engine.assets.add_audio("thruster1", "assets/thruster2.mp3"));
          engine.assets.add_image("laser1", "assets/laser1.png");
          engine.assets.add_image("planet", "assets/planet.jpg");
          engine.assets.add_image("test", "assets/fighter2.png");
          engine.assets.add_image("station", "assets/station.png");
          engine.assets.add_image("ship1", "assets/ship1.png");
          engine.assets.add_image("ship2", "assets/ship2.png");
          engine.assets.add_image("ship2", "assets/ship2.png");
          engine.assets.add_image("ship3", "assets/ship3.png");
          engine.assets.add_image("ship4", "assets/ship4.png");
          engine.assets.add_image("trash", "assets/trash.png");
        },
        entity_loading_function: function(world, assets){
          const planet = Sprite.create(
            0, 0,
            game.engine.viewport.height*1.5,
            game.engine.viewport.width*2.7,
            0,
            assets.images["planet"]
            );
          world.add_entity(planet, 5);

          const car = ShootingEntity.extend(DriveableEntity.extend(MoveableEntity.extend(SolidEntity.extend(Sprite.create(0, 0, 60, 65, Math.PI, assets.images["test"])))));
          car.is_selected = true;
          car.acceleration = 7;
          car.acceleration_time = 1;
          car.rotation = 4;
          world.add_player_entity(car);

          const station = MoveableEntity.extend(
            Sprite.create(-600, -800, 500, 500, 6, assets.images["station"])
          );
          station.friction = 0;
          station.state.rotate = 0.02;
          world.add_entity(station, 20);

          for(var i = 0; i<100; i++){
            world.add_entity(DamageableEntity.extend(
              MoveableEntity.extend(
                SolidEntity.extend(
                  Sprite.create(-20000+Math.random()*40000,
                    -1000+Math.random()*2000,
                    90,
                    120,
                    Math.random()*Math.PI*2,
                    assets.images["ship1"])
                  )
                )
              )
            );
          }

          world.add_entity(Sprite.create(2200, 2000, 500, 900, 4, assets.images["ship2"]), 40);

          world.add_entity( Sprite.create(5000, 1900, 300, 600, 4.1, assets.images["ship3"]), 18);

          const some_ship = MoveableEntity.extend(Sprite.create(510, 3000, 400, 800, 3.4, assets.images["ship4"]));
          some_ship.state.forward = true;
          some_ship.acceleration = 0.5;
          some_ship.acceleration_time = 20;
          world.add_entity(some_ship, 26);

          world.add_entity( Sprite.create(2900, 1900, 1400, 2200, 4.5, assets.images["ship2"]), 115);
          world.add_entity( Sprite.create(-2500, -1000, 1200, 1800, 1.5, assets.images["ship2"]), 108);

          world.add_entity(SolidEntity.extend(Sprite.create(1220, 300, 100, 100, 1, assets.images["trash"] )));
          world.add_entity(SolidEntity.extend(Sprite.create(1250, 150, 110, 110, 0.5, assets.images["trash"] )));
          world.add_entity(SolidEntity.extend(Sprite.create(1300, 550, 80, 80, 3, assets.images["trash"] )));
        },

        handle_mouse_move: function(engine, event){
          const adjusted_x = event.clientX - engine.canvas.getBoundingClientRect().left;
          const adjusted_y = event.clientY - engine.canvas.getBoundingClientRect().top;
          engine.cursor.move_to(adjusted_x, adjusted_y);
        },

        handle_key: function(engine, event, pressed){
          engine.world.handle_key(event, pressed);
        },

        handle_mouse_button: function(engine, event, pressed){
          engine.cursor.set_pressed(pressed);
          engine.world.handle_mouse_button(event, pressed);
        },
      };
    })();

    game.set_scene(title_scene);
    game.run();
  </script>
</body>
</html>
